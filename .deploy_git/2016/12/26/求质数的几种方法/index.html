<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"><title>vv13</title><link rel="stylesheet" href="/css/vv13.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_438575_w9o3rescwyp919k9.css"><link rel="icon" href="/undefined"></head><body><div id="content-outer"><link rel="stylesheet" href="/css/github-markdown.css"><article class="markdown-body" id="post"><h1 class="article-title">python求质数的几种方法</h1><div class="title-info"><time class="post-time" datetime="2016-12-25T16:02:23.000Z">12.26, 2016</time><div class="title-item"><a href="/tags/python/"><i class="iconfont icon-tag">python</i></a></div></div><p>今天偶然在博客上上看到有人提<a href="http://blog.csdn.net/program_think/article/details/7032600/" target="_blank" rel="external">求质素的几种境界</a>,在此用python进行实现代码,并进行简单的说明.</p>
<p>我们将要实现函数的功能是输入一个数N,能把小于N的质数个数打印出来,并计算出所耗时间.</p>
<h3 id="境界1"><a href="#境界1" class="headerlink" title="境界1"></a>境界1</h3><p>我们采用试除法,意思就是将比N小的符合要求的每一个数都除以它,若都无法整除则N为质数,这也是我们能想到的最简单的方法,我们可以从j的范围进行优化一下,很容易想到j的范围可以取<code>2~N/2</code>.<br>代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">def f1(num):</div><div class="line">    # 2也是质数,之后程序从3开始判断</div><div class="line">    count = 1</div><div class="line">    for i in range(3, num):</div><div class="line">        b = True</div><div class="line">        for j in range(2, i/2 + 1):</div><div class="line">            if i % j == 0:</div><div class="line">                b = False</div><div class="line">                break</div><div class="line">        if b:</div><div class="line">            count += 1</div><div class="line">    return count</div><div class="line"></div><div class="line">f1(100000)</div><div class="line"># 耗时35.1589805796秒, 个数9592</div></pre></td></tr></table></figure>
<h3 id="境界2"><a href="#境界2" class="headerlink" title="境界2"></a>境界2</h3><p>我们可以从j的范围再进行优化一下,最优的范围是<code>2~sqrt(N)</code>,这是因为因数都是成对出现,一个因子不可能超过sqrt(N).再思考一下,除了2以外所有偶数都不会是质数,因此可将偶数全部排除掉,让我们来修改并测试一下程序:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">def f1(num):</div><div class="line">    count = 1</div><div class="line">    # 优化点1:偶数不做判断</div><div class="line">    for i in range(3, num, 2):</div><div class="line">        b = True</div><div class="line">        sq = int(math.sqrt(i)) + 1</div><div class="line">        # 优化点2:缩小试除范围</div><div class="line">        for j in range(2, sq):</div><div class="line">            if i % j == 0:</div><div class="line">                b = False</div><div class="line">                break</div><div class="line">        if b:</div><div class="line">            count += 1</div><div class="line">    return count</div><div class="line"></div><div class="line">f1(100000)</div><div class="line"># 耗时0.264536051872秒, 个数9592</div></pre></td></tr></table></figure>
<h3 id="境界3"><a href="#境界3" class="headerlink" title="境界3"></a>境界3</h3><p>是否很有趣,通过一步一步的优化从35秒优化到了0.26秒,我们接着进行优化,普通程序员也许在境界2就浅尝辄止了,可是境界永远是用无止境的.</p>
<p>细想一下, 比如判断101是否为质数,<code>sqrt(101)</code>为10, 那我们就要依次用这个数去除以<code>2, 3, 5, 7, 9</code>,大家主要到其实只要除以了3以后就不用除以9了,这样我们就找到了切入点:只要尝试小于sqrt(n) 的<strong>质数</strong>即可. 顺着这个思路,我们会将求得的质数临时保存起来,于是就有了以下方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">def f2(num):</div><div class="line">    arrs = [2]</div><div class="line">    count = 1</div><div class="line">    # 质数数组中的索引</div><div class="line">    stop = 0</div><div class="line">    for i in range(3, num):</div><div class="line">        k = int(math.sqrt(i))</div><div class="line">        while stop &lt; count and arrs[stop] &lt;= k:</div><div class="line">            stop += 1</div><div class="line">        # 整除计数</div><div class="line">        j = 0</div><div class="line">        for k in range(stop):</div><div class="line">            if i % arrs[j] == 0:</div><div class="line">                break</div><div class="line">            j += 1</div><div class="line">        # 判定为质数后加入质数数组</div><div class="line">        if j == stop:</div><div class="line">            arrs.append(i)</div><div class="line">            count += 1</div><div class="line">    return count</div><div class="line"></div><div class="line">f2(100000)</div><div class="line"># 耗时0.199287338917秒, 个数9592</div></pre></td></tr></table></figure>
<h3 id="境界4"><a href="#境界4" class="headerlink" title="境界4"></a>境界4</h3><p>以上都是试除法,现在让我们来尝试以下筛法.让我们先看以下维基百科上十分形象的一张筛法工作原理图:</p>
<p><img src="http://7xp5r4.com1.z0.glb.clouddn.com/16-4-23/38858775.jpg" alt=""></p>
<p>首先2是质数,因此将2的倍数全部去掉;3为质数,理应将6,9,12等去掉,同理我们只要指定一个质数范围,扩大其倍数进行筛选,将不大于N的所有倍数都筛除掉,剩下的就为质数!</p>
<p>我们在运用筛选法的时候,当然还是得用以上总结出来的各种技巧:</p>
<ul>
<li>试除数的范围是为２～sqrt(N),同理质数求合数范围也取这个值</li>
<li>筛法的初始化数组因为要占用字节空间,应尽可能的取小.在此我们用bool型来表示,1代表质数,0代表合数,这样开销会更小</li>
<li>用加法代替乘法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">def f4(num):</div><div class="line">    # 初始化时将偶数全预筛除掉</div><div class="line">    arrs = [0 if _i % 2 == 0 else 1 for _i in range(num + 1)]</div><div class="line">    arrs[2] = 1</div><div class="line">    count = 0</div><div class="line">    for i in range(3, int(math.sqrt(num)), 2):</div><div class="line">        if arrs[i] == 0:</div><div class="line">            continue</div><div class="line">        # j为i的合数,此处用加法代替乘法</div><div class="line">        j = i + i</div><div class="line">        while j &lt;= num:</div><div class="line">            arrs[j] = 0</div><div class="line">            j += i</div><div class="line">    # 计数</div><div class="line">    for k in range(2, num + 1):</div><div class="line">        if arrs[k] == 1:</div><div class="line">            count += 1</div><div class="line">    return count</div><div class="line"></div><div class="line">f4(100000)</div><div class="line"># 耗时0.03232869726秒, 个数9592</div></pre></td></tr></table></figure>
<h3 id="境界5"><a href="#境界5" class="headerlink" title="境界5"></a>境界5</h3><p>…</p>
</article><div id="commenter"></div><link rel="stylesheet" href="/css/dark.css"><script src="/js/gitment.js"></script><script>var gitment = new Gitment({
owner: 'vv13',
repo: 'vv13.github.io',
oauth: {
    client_id: 'fc26f0c5db6ee176856d',
    client_secret: 'adaddc022d70102d2f037f675d0b29a13d5283dd',
},
})
gitment.render('commenter')</script><div id="footer"><div>vv13 &copy; 2017</div><div class="shortcut"><a href="/atom.xml"><i class="iconfont icon-rss" aria-hidden="true"></i></a><a href="https://github.com/vv13"><i class="iconfont icon-github" aria-hidden="true"></i></a></div></div><div class="side-menu"><div class="shortcut" id="goHome"><a href="/"><i class="icon-home iconfont" aria-hidden="true"></i></a></div><div class="shortcut" id="goTop"><i class="icon-yijiantisheng iconfont" aria-hidden="true"></i></div></div></div><script src="/js/vv13.js"></script><div id="container"></div></body></html>